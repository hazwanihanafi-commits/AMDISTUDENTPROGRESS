<!doctype html>
<html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>AMDI Portal</title>
<script src="https://www.gstatic.com/charts/loader.js"></script><style>:root{--accent:#4b0082;--accent2:#5a2d82;--bg:#eef3f6;--card:rgba(255,255,255,0.72);--glass-border:rgba(255,255,255,0.6);--text:#102028}*{box-sizing:border-box}body{margin:0;font-family:Inter,Arial;background:linear-gradient(180deg,#f6f9fb,#eef3f6);color:var(--text)}.topbar{height:72px;display:flex;align-items:center;padding:12px 22px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff}.brand{display:flex;gap:12px;align-items:center}.logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,#c79810,rgba(255,255,255,0.08));display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff}.wrapper{display:flex;gap:18px;max-width:1200px;margin:22px auto;padding:0 16px}.sidebar{width:220px;border-radius:14px;background:var(--card);backdrop-filter: blur(8px);border:1px solid var(--glass-border);padding:12px;height:calc(100vh - 150px)}.nav-item{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;color:var(--text);cursor:pointer;margin-bottom:6px}.nav-item.active{background:linear-gradient(90deg, rgba(75,0,130,0.12), rgba(90,45,130,0.06));font-weight:700;color:var(--accent2)}.content{flex:1}.page{display:none}.page.active{display:block}.row{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px;margin-bottom:14px}.card{background:var(--card);border-radius:12px;padding:16px;border:1px solid var(--glass-border);backdrop-filter: blur(8px);box-shadow:0 10px 28px rgba(11,89,97,0.06)}.button{background:var(--accent);color:#fff;padding:10px 12px;border-radius:10px;text-decoration:none}.result{margin-top:8px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.9);border:1px solid #eee;white-space:pre-wrap}.footer{max-width:1200px;margin:18px auto;text-align:center;color:#6b6b78}@media(max-width:900px){.wrapper{flex-direction:column}.sidebar{width:100%;height:auto;display:flex;flex-wrap:wrap}}</style></head><body><div class="topbar"><div class="brand"><div class="logo">AM</div><div><div style="font-size:20px;font-weight:700">AMDI Postgraduate Portal</div><div style="font-size:12px;opacity:0.9">Universiti Sains Malaysia</div></div></div></div><div class="wrapper"><aside class="sidebar"><div style="font-weight:700;margin-bottom:8px">Navigation</div><div class="nav-item active" data-page="home">ğŸ  Home</div><div class="nav-item" data-page="dashboard">ğŸ“Š Dashboard</div><div style="margin-top:8px;font-size:12px;color:#667">Submissions</div><div class="nav-item" data-page="p1">ğŸ“„ P1</div><div class="nav-item" data-page="p3">ğŸ“ P3</div><div class="nav-item" data-page="p4">ğŸ“ P4</div><div class="nav-item" data-page="p5">ğŸ“ P5</div><div style="margin-top:8px;font-size:12px;color:#667">Management</div><div class="nav-item" data-page="supervisor">ğŸ§‘â€ğŸ« Supervisor</div><div class="nav-item" data-page="admin">âš™ï¸ Admin</div><div style="margin-top:12px;font-size:12px;color:#667">Quick links</div><a class="button" style="display:inline-block;margin-top:8px" href="/assets/mockup.png" target="_blank">Mockup</a></aside><main class="content"><section id="page-home" class="page active"><div class="row"><div class="card"><h3>Welcome</h3><p>Use the navigation to manage submissions and approvals.</p></div><div class="card"><h3>Progress Checker</h3><input id="matricHome" placeholder="Enter matric"/><div style="margin-top:8px"><button class="button" id="checkHomeBtn">Check</button></div><div id="homeResult" class="result" style="display:none"></div></div></div><div class="row"><div class="card"><h3>Recent Submissions</h3><div id="recentList" class="result">Loading...</div></div><div class="card"><h3>P5 Rubrics</h3><a class="button" href="https://drive.google.com/file/d/14lnVIl1a2nhFD_eOTOqC_qCTySum_t1G/view?usp=drive_link" target="_blank">MSc Rubric</a></div></div></section><section id="page-dashboard" class="page"><div class="row"><div class="card"><h3>KPIs</h3><div id="kpiBoxes" style="display:flex;gap:8px;flex-wrap:wrap"></div><div style="margin-top:10px"><button class="button" onclick="refreshDashboard()">Refresh</button></div></div><div class="card"><h3>Charts</h3><div id="chartPie" style="height:240px"></div></div></div><div class="card"><h3>Detailed Charts</h3><div id="chartBar" style="height:320px"></div></div></section><section id="page-supervisor" class="page"><div class="row"><div class="card"><h3>Supervisor Panel</h3><input id="approveMatric" placeholder="Matric to approve"/><div style="margin-top:8px;display:flex;gap:8px"><button class="button" data-stage="P1" onclick="approveStage(this)">Approve P1</button><button class="button" data-stage="P3" onclick="approveStage(this)">Approve P3</button></div><div id="approveResult" class="result" style="display:none"></div></div><div class="card"><h3>Approval Log</h3><div style="margin-top:8px"><a class="button" href="/api/approval_log" target="_blank">Download CSV</a></div></div></div></section><section id="page-admin" class="page"><div class="card"><h3>Admin Tools</h3><div style="display:flex;gap:8px"><button class="button" id="createTriggerBtn">Create Daily Trigger</button><button class="button" id="runReportBtn">Generate Monthly Report</button></div><div id="adminOut" class="result" style="display:none"></div></div></section></main></div><div class="footer">AMDI â€¢ Universiti Sains Malaysia</div><script>const BASE='/api';const navItems=Array.from(document.querySelectorAll('.nav-item'));navItems.forEach(item=>item.addEventListener('click',(e)=>{navItems.forEach(i=>i.classList.remove('active'));item.classList.add('active');const page=item.getAttribute('data-page');showPage(page);}));function showPage(page){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));const el=document.getElementById('page-'+page);if(el)el.classList.add('active');if(page==='dashboard')refreshDashboard();if(page==='home')loadRecent();}(function(){const params=new URLSearchParams(location.search);const page=params.get('page')||'home';const nav=document.querySelector(`.nav-item[data-page="${page}"]`);if(nav)nav.classList.add('active');showPage(page);})();document.getElementById('checkHomeBtn').addEventListener('click',async()=>{const m=document.getElementById('matricHome').value.trim();const out=document.getElementById('homeResult');if(!m){out.style.display='block';out.textContent='Enter matric';return;}out.style.display='block';out.textContent='Loading...';try{const r=await fetch(BASE+'/status?matric='+encodeURIComponent(m));const j=await r.json();out.textContent=JSON.stringify(j,null,2);}catch(e){out.textContent='Error: '+e}});async function loadRecent(){const out=document.getElementById('recentList');out.textContent='Loading...';try{const r=await fetch(BASE+'/dashboardData');const j=await r.json();out.textContent='Total tracked: '+(j.totals?j.totals.total:'n/a');}catch(e){out.textContent='Error: '+e}}google.charts.load('current',{'packages':['corechart']});google.charts.setOnLoadCallback(()=>{if(document.getElementById('page-dashboard').classList.contains('active'))refreshDashboard();});async function refreshDashboard(){try{const r=await fetch(BASE+'/dashboardData');const j=await r.json();const totals=j.totals||{};const kdiv=document.getElementById('kpiBoxes');kdiv.innerHTML='';['total','P1','P3','P4','P5','completed'].forEach(k=>{const el=document.createElement('div');el.style.minWidth='110px';el.style.padding='8px';el.style.background='#fff';el.style.borderRadius='8px';el.innerHTML=`<div style="font-size:12px;color:#666">${k}</div><div style="font-weight:700;font-size:18px">${totals[k]||0}</div>`;kdiv.appendChild(el);});const data=google.visualization.arrayToDataTable([['Stage','Count'],['P1',totals.P1||0],['P3',totals.P3||0],['P4',totals.P4||0],['P5',totals.P5||0]]);const pie=new google.visualization.PieChart(document.getElementById('chartPie'));pie.draw(data,{pieHole:0.35,legend:{position:'right'}});const barData=google.visualization.arrayToDataTable([['Label','Count'],['Total',totals.total||0],['Completed',totals.completed||0]]);const bar=new google.visualization.BarChart(document.getElementById('chartBar'));bar.draw(barData);}catch(e){console.error(e);} }async function approveStage(btn){const stage=btn.getAttribute('data-stage');const matric=document.getElementById('approveMatric').value.trim();const out=document.getElementById('approveResult');if(!matric){out.style.display='block';out.textContent='Enter matric';return;}out.style.display='block';out.textContent='Approving...';try{const resp=await fetch(BASE+'/approve',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({matric,stage})});const j=await resp.json();out.textContent=JSON.stringify(j,null,2);}catch(e){out.textContent='Error: '+e}}document.getElementById('createTriggerBtn').addEventListener('click',()=>{fetch(BASE+'/createTrigger').then(r=>r.text()).then(t=>{document.getElementById('adminOut').style.display='block';document.getElementById('adminOut').textContent=t;});});document.getElementById('runReportBtn').addEventListener('click',()=>{fetch(BASE+'/createMonthlyReport').then(r=>r.text()).then(t=>{document.getElementById('adminOut').style.display='block';document.getElementById('adminOut').textContent=t;});});loadRecent();</script></html>